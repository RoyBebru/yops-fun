window.SVG3DTagCloud=function(element,params){var settings={entries:[],width:480,height:480,radius:"70%",radiusMin:75,bgDraw:!0,bgColor:"#000",opacityOver:1,opacityOut:.05,opacitySpeed:6,fov:800,speed:2,fontFamily:"Arial, sans-serif",fontSize:"15",fontColor:"#fff",fontWeight:"normal",fontStyle:"normal",fontStretch:"normal",fontToUpperCase:!1,tooltipFontFamily:"Arial, sans-serif",tooltipFontSize:"15",tooltipFontColor:"#fff",tooltipFontWeight:"normal",tooltipFontStyle:"normal",tooltipFontStretch:"normal",tooltipFontToUpperCase:!1,tooltipTextAnchor:"left",tooltipDiffX:0,tooltipDiffY:10};if(void 0!==params)for(var prop in params)params.hasOwnProperty(prop)&&settings.hasOwnProperty(prop)&&(settings[prop]=params[prop]);if(!settings.entries.length)return!1;var tooltip,radius,diameter,center2D,svg,bg,entryHolder=[],mouseReact=!0,mousePos={x:0,y:0},center3D={x:0,y:0,z:0},speed={x:0,y:0},position={sx:0,cx:0,sy:0,cy:0},MATHPI180=Math.PI/180,svgNS="http://www.w3.org/2000/svg";function reInit(){var windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,svgWidth=windowWidth,svgHeight=windowHeight;if(0<settings.width.toString().indexOf("%")||0<settings.height.toString().indexOf("%")){svgWidth=Math.round(element.offsetWidth/100*parseInt(settings.width));svgHeight=Math.round(svgWidth/100*parseInt(settings.height))}else{svgWidth=parseInt(settings.width);svgHeight=parseInt(settings.height)}center2D={x:(svgWidth=windowWidth<=svgWidth?windowWidth:svgWidth)/2,y:(svgHeight=windowHeight<=svgHeight?windowHeight:svgHeight)/2};speed.x=settings.speed/center2D.x;speed.y=settings.speed/center2D.y;diameter=svgHeight<=svgWidth?svgHeight/100*parseInt(settings.radius):svgWidth/100*parseInt(settings.radius);if((radius=(diameter=diameter<1?1:diameter)/2)<settings.radiusMin){radius=settings.radiusMin;diameter=2*radius}svg.setAttribute("width",svgWidth);svg.setAttribute("height",svgHeight);if(settings.bgDraw){bg.setAttribute("width",svgWidth);bg.setAttribute("height",svgHeight)}!function(radius){for(var i=0,l=entryHolder.length;i<l;i++)!function(entry,radius){var dx=entry.vectorPosition.x-center3D.x,dy=entry.vectorPosition.y-center3D.y,dz=entry.vectorPosition.z-center3D.z,dx=Math.sqrt(dx*dx+dy*dy+dz*dz);entry.vectorPosition.x/=dx;entry.vectorPosition.y/=dx;entry.vectorPosition.z/=dx;entry.vectorPosition.x*=radius;entry.vectorPosition.y*=radius;entry.vectorPosition.z*=radius}(entryHolder[i],radius)}(radius)}function addTooltip(){(tooltip=document.createElementNS(svgNS,"text")).setAttribute("x",0);tooltip.setAttribute("y",0);tooltip.setAttribute("fill",settings.tooltipFontColor);tooltip.setAttribute("font-family",settings.tooltipFontFamily);tooltip.setAttribute("font-size",settings.tooltipFontSize);tooltip.setAttribute("font-weight",settings.tooltipFontWeight);tooltip.setAttribute("font-style",settings.tooltipFontStyle);tooltip.setAttribute("font-stretch",settings.tooltipFontStretch);tooltip.setAttribute("text-anchor",settings.tooltipTextAnchor);tooltip.textContent="";svg.appendChild(tooltip)}function getEntryByElement(element){for(var i=0,l=entryHolder.length;i<l;i++){var entry=entryHolder[i];if(entry.element.getAttribute("x")===element.getAttribute("x")&&entry.element.getAttribute("y")===element.getAttribute("y"))return entry}}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)};function animloop(){requestAnimFrame(animloop);var fx=speed.x*mousePos.x-settings.speed,fy=settings.speed-speed.y*mousePos.y,fx=fx*MATHPI180,fy=fy*MATHPI180;position.sx=Math.sin(fx);position.cx=Math.cos(fx);position.sy=Math.sin(fy);position.cy=Math.cos(fy);for(var i=0,l=entryHolder.length;i<l;i++){var entry=entryHolder[i];if(mouseReact){var rx=entry.vectorPosition.x,rz=entry.vectorPosition.y*position.sy+entry.vectorPosition.z*position.cy;entry.vectorPosition.x=rx*position.cx+rz*position.sx;entry.vectorPosition.y=entry.vectorPosition.y*position.cy+entry.vectorPosition.z*-position.sy;entry.vectorPosition.z=rx*-position.sx+rz*position.cx}var opacity,rx=settings.fov/(settings.fov+entry.vectorPosition.z);entry.vector2D.x=entry.vectorPosition.x*rx+center2D.x;entry.vector2D.y=entry.vectorPosition.y*rx+center2D.y;if(entry.diffX&&entry.diffY){entry.vector2D.x-=entry.diffX;entry.vector2D.y-=entry.diffY}entry.element.setAttribute("x",entry.vector2D.x);entry.element.setAttribute("y",entry.vector2D.y);if(mouseReact)(opacity=(radius-entry.vectorPosition.z)/diameter)<settings.opacityOut&&(opacity=settings.opacityOut);else{opacity=parseFloat(entry.element.getAttribute("opacity"));entry.mouseOver?opacity+=(settings.opacityOver-opacity)/settings.opacitySpeed:opacity+=(settings.opacityOut-opacity)/settings.opacitySpeed}entry.element.setAttribute("opacity",opacity)}entryHolder=entryHolder.sort(function(a,b){return b.vectorPosition.z-a.vectorPosition.z})}function mouseOverHandler(event){mouseReact=!1;event=getEntryByElement(event.target);!function(entry){for(var i=0,l=entryHolder.length;i<l;i++){var e=entryHolder[i];e.index===entry.index?e.mouseOver=!0:e.mouseOver=!1}}(event);event.tooltip&&!function(entry){if(entry.tooltip){tooltip.setAttribute("x",entry.vector2D.x-settings.tooltipDiffX);tooltip.setAttribute("y",entry.vector2D.y-settings.tooltipDiffY);tooltip.textContent=settings.tooltipFontToUpperCase?entry.tooltipLabel.toUpperCase():entry.tooltipLabel;tooltip.setAttribute("opacity",1)}}(event)}function mouseOutHandler(event){mouseReact=!0;event=getEntryByElement(event.target);event.tooltip&&tooltip.setAttribute("opacity",0)}function mouseMoveHandler(event){mousePos=function(svg,event){svg=svg.getBoundingClientRect();return{x:event.clientX-svg.left,y:event.clientY-svg.top}}(svg,event)}function resizeHandler(event){reInit()}!function(){(svg=document.createElementNS(svgNS,"svg")).addEventListener("mousemove",mouseMoveHandler);element.appendChild(svg);if(settings.bgDraw){(bg=document.createElementNS(svgNS,"rect")).setAttribute("x",0);bg.setAttribute("y",0);bg.setAttribute("fill",settings.bgColor);svg.appendChild(bg)}for(var tooltip=!1,i=1,l=settings.entries.length+1;i<l;i++){var phi=Math.acos(2*i/l-1),theta=Math.sqrt(l*Math.PI)*phi,x=Math.cos(theta)*Math.sin(phi),theta=Math.sin(theta)*Math.sin(phi),phi=Math.cos(phi),x=function(index,entryObj,x,y,z){var entry={};if(void 0!==entryObj.label){entry.element=document.createElementNS(svgNS,"text");entry.element.setAttribute("x",0);entry.element.setAttribute("y",0);entry.element.setAttribute("fill",settings.fontColor);entry.element.setAttribute("font-family",settings.fontFamily);entry.element.setAttribute("font-size",settings.fontSize);entry.element.setAttribute("font-weight",settings.fontWeight);entry.element.setAttribute("font-style",settings.fontStyle);entry.element.setAttribute("font-stretch",settings.fontStretch);entry.element.setAttribute("text-anchor","middle");entry.element.textContent=settings.fontToUpperCase?entryObj.label.toUpperCase():entryObj.label}else if(void 0!==entryObj.image){entry.element=document.createElementNS(svgNS,"image");entry.element.setAttribute("x",0);entry.element.setAttribute("y",0);entry.element.setAttribute("width",entryObj.width);entry.element.setAttribute("height",entryObj.height);entry.element.setAttribute("id","image_"+index);entry.element.setAttributeNS("http://www.w3.org/1999/xlink","href",entryObj.image);entry.diffX=entryObj.width/2;entry.diffY=entryObj.height/2}entry.link=document.createElementNS(svgNS,"a");if(void 0!==entryObj.click){entry.link.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#");entry.link.setAttribute("target","_top");entry.link.addEventListener("click",function(){entryObj.click(entryObj.url)},!0)}else{entry.link.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",entryObj.url);entry.link.setAttribute("target",entryObj.target)}entry.link.addEventListener("mouseover",mouseOverHandler,!0);entry.link.addEventListener("mouseout",mouseOutHandler,!0);entry.link.appendChild(entry.element);if(void 0!==entryObj.tooltip){entry.tooltip=!0;entry.tooltipLabel=settings.tooltipFontToUpperCase?entryObj.tooltip.toUpperCase():entryObj.tooltip}else entry.tooltip=!1;entry.index=index;entry.mouseOver=!1;entry.vectorPosition={x:x,y:y,z:z};entry.vector2D={x:0,y:0};svg.appendChild(entry.link);return entry}(i-1,settings.entries[i-1],x,theta,phi);entryHolder.push(x);void 0!==settings.entries[i-1].tooltip&&(tooltip=!0)}tooltip&&addTooltip();reInit();animloop();window.addEventListener("resize",resizeHandler)}()};"undefined"!=typeof jQuery&&(($=jQuery).fn.svg3DTagCloud=function(params){var args=arguments;return this.each(function(){if($.data(this,"plugin_SVG3DTagCloud")){var plugin=$.data(this,"plugin_SVG3DTagCloud");plugin[params]?plugin[params].apply(this,Array.prototype.slice.call(args,1)):$.error("Method "+params+" does not exist on jQuery.svg3DTagCloud")}else $.data(this,"plugin_SVG3DTagCloud",new SVG3DTagCloud(this,params))})});var $;